# 一、定义 Django 独立应用的范围

每个软件项目都是由边界定义的，不管你是否有意选择了它们。在这一章中，我们将通过探索开发——和共享——你的独立应用的好处，开始我们的 Django 独立应用的冒险，以及如何考虑带来什么其他依赖，甚至你的 Django 应用是否应该是一个 Django 应用。

## 创建独立应用的优势

创建一个 Django 独立应用的好处是多种多样的，有利他的，利己的，也有纯粹实用的。

### 分享您的作品

假设你计划将你的应用作为开源包发布，大多数人想到的第一个好处是与他人分享你的工作的价值。在软件社区中，共享代码已经有很长的历史了(只要还有囤积的历史！)因为在大多数情况下，这是一种其他人可以从你已经做的事情中受益，而不会让你失去任何机会的方式。除非你认为你能够授权和销售你的 Django 应用，否则它本身不太可能是一个盈利的企业。既然你已经从别人免费分享的作品中获益，为什么不分享回来呢？

### 提高代码质量

一旦你开始分享你的工作，一个连锁反应往往是你的应用本身质量的提高。大多数人第一次公开分享他们的作品时会感到有点紧张，因为现在每个人都可以仔细检查。但是知道其他人会阅读和/或使用你的代码会让你更加小心你如何设计和开发它。一旦有足够多的人使用它，你将开始吸引其他人的贡献，无论是以错误报告的形式(是的，识别错误是一种贡献！)、错误修复、功能建议和新功能。

### 不要重复你自己

如果你正在寻找更实际的原因，是时候开始思考应用“可重用”的含义了作为开发人员，拥有可重用的代码可以节省时间和降低风险。您可以使用已经创建的内容和您知道已经有效的内容。

想象一下，如果每次创建一个新的 Django 项目，您都必须从头开始编写自己的认证系统，包括视图、中间件和模型。不可避免的是，您可能只是将代码从一个项目复制并粘贴到另一个项目，希望留下错误，并且从来没有真正的最佳实践集合。谢天谢地，你不必这么做，因为 Django 的 contrib 模块中就有这样一个可重用的应用。

这就谈到了风险的问题。代码中的风险可以从 bug 到你没有想到的重要特性，并且，*所有的事情都是平等的*，当你从零开始独自工作时，这些风险会增加。我们从可重用应用中寻求的不仅仅是从从头开始编写代码中节省的时间，还有最佳实践的积累，来自真实世界使用的功能，以及有机会被消除的错误。

### 整个公司的通用性

对于支持各种已部署的 Django 应用的开发人员和团队来说，支持一个公司的一个产品或多个产品，例如，将通用功能提取到可重用的应用中，这是一种确保功能在任何地方都能按预期工作的方式，并使您能够修复 bug 或添加关键的新功能，以便可以在任何使用它的地方部署版本更新。

示例包括定制的用户应用、特定领域的模型(例如，健康科学、金融)、资产管理和通用工具。

### 客户项目的共性

对于自由职业者或代理角色的开发人员和团队来说，与各种客户和项目一起工作，可重用的应用是跨项目携带有用功能的一种方式。

Django 中大多数流行的内容管理和电子商务解决方案都是这样产生的。Django CMS 和 Wagtail 是两个流行的基于 Django 的内容管理系统，也是独立的 Django 应用，由创意机构开发，作为客户项目的解决方案。

### 声望的流通

最后，虽然通常不言而喻，但有一个受欢迎的或至少有用的独立应用，这是一种可感知的声望——我们不会用“虚荣”这个词。对于产品团队、代理团队和自由职业者来说，一个共享的独立应用是能力、观点和视野的展示。它可以用来吸引潜在的雇员和潜在的客户。

前面提到的内容管理系统 Django CMS 和 Wagtail 分别由 Divio 和 Torchbox 创建。他们做了伟大的工作，但是有多少 Django 开发者会知道他们的名字不是为了他们各自 CMS 的贡献？他们在招聘中的知名度现在肯定有所提高。我自己不能说出任何特别的恶名，但是由于我自己发布的 Django 应用，一些客户直接或间接地发现了我。

现在，如果这是你想创建和发布 Django 独立应用的唯一原因，我建议你把注意力转移到别的地方。拥有一个被大量人使用的应用的连锁效应可能会慢慢积累，你也不太可能喜欢构建和维护应用的过程，你的用户群也可能会受到影响。

但是，如果你的目标包括与社区共享、创建不断改进的代码库、减少开发时间和风险，那么不管你的 GitHub 档案为你赢得多少虚假的互联网积分，努力都是值得的。

## 有没有 Django？

在定义一个潜在的 Django 独立应用的范围时，你需要问的第一个问题是，你心目中的包是否需要是一个 Django 应用，或者仅仅是一个使用 Django 的 Python 包，第二个问题是，即使它不是一个应用，你的包也应该是特定于 Django 的。

第一个问题是一个有点小的问题，但是涉及到你的应用应该如何集成到其他 Django 项目和开发工作流中。很容易在 Python 文件中看到 Django 导入，并认为“啊，这是一个应用”，而实际上它是不可安装的库代码(不可安装是指 INSTALLED_APPS，而不是指已安装的包)。例如，如果您想要分发一些额外的表单字段，这些字段可以作为“常规”Python 库分发和使用，而无需将模块添加到 INSTALLED_APPS 列表中。你仍然需要考虑后续章节中讨论的问题，比如测试(3，21)，文档(22)，和打包(8)，但是在你如何设置你的测试和文档使用上有一些小的不同。

另一方面，您预期的包在 Django 项目中可能非常有用，但对 Django 没有硬性要求，不知道 web 框架甚至根本不知道用于 web 应用。如果是这样，那么你应该沿着这条路走下去。

为什么要保证这种分离？首先，如果你要与世界其他地方分享，并且核心功能实际上不依赖于 Django，那么你已经扩大了受众。您还减少了您的包中的另一个依赖项，即使您在 Django 项目中使用它，这也是另一个可能中断的依赖项。在有意义的地方，参考标准库而不是 Django 实用程序。如果有东西在新的 Django 版本中移动，你现在就与这种变化绝缘了。

值得记住的是，您可以向 Django 项目添加功能，而无需特定于 Django 的模块，或者不一定需要 Django。在关于混合依赖支持的第十六章中，我们将研究如何区分哪些是 Django 特有的，哪些不是。

## 选择依赖关系

像您正在创建的这样的包的伟大之处在于，它们为您提供了免费的功能——也许不是免费的，但是不需要您自己编写代码和找出边缘情况的成本。这些好处假设您正在使用的依赖项已经过测试，并且如宣传的那样工作，并且它们继续受到新版本的 Python、Django 及其各自的依赖项的支持。

您添加的每个依赖项都增加了您需要测试的表面积，以及中断交互的机会。在 Django 项目中是这样，在你自己的独立应用中也是这样。现在，自己重写一切当然是不明智的！但是要仔细考虑是否真的需要在项目中添加每个依赖项。

在引导性问题中，您应该考虑

1.  依赖关系是否为您的应用提供了必要的功能？

2.  你将支持的 Django 版本是最新的吗？

3.  它有什么样的测试和文档覆盖？

4.  维护者看起来有多忠诚？

### 必要的功能

向项目和库添加依赖项是很容易的。在大多数 Django 项目中，项目只有一个“消费者”,即项目团队。这可能是一个拥有多个不同环境部署和数百万用户的大型团队，但该团队和该应用仍然是唯一的消费者。有了像 Django 独立应用这样的可重用库，您可以预期它将被用于数十个，甚至数千个其他项目。应用的每个依赖项都是使用应用的项目的依赖项。如果你添加到应用中的每个依赖项包含错误或不兼容的代码，并使你面临风险，那么它就是一个潜在的拦截器。

这与您在 Django 项目中添加依赖项的方式没有太大的不同；然而，当您控制最终部署并且其他人不再依赖您自己的代码时，退出这些更改会更容易。

所以问一下是否有必要增加这一点，不是从严格的逻辑意义上，而是是否增加了更多的便利。

这是我犯的一个“错误”。我自己案例中的一个例子是，我决定使用 django-extensions 应用作为我自己的 django-organizations 的依赖项。我想要一个带时间戳的模型——这是一个好东西，当它丢失时，你会注意到它——此外，我还想要一个会自己处理的 slug 字段。为此，我想要 AutoslugField。与其说这是一个限制性的决定，不如说是一个糟糕的决定。然而，我可以使用一个典型的 Django slug 字段，但是出于我自己的需要，Autoslug 就在那里。后来我意识到，有些人，包括我自己，可能需要能够配置 slugs 是如何制造的，这不应该如此固定。

### 版本兼容性

由于 Python 2 的寿终正寝，与两年前甚至一年前相比，现在对 Python 版本兼容性的考虑已经不那么重要了。然而，Django 兼容性仍然是一个问题。正在讨论的依赖项是否支持您经常使用的 Django 的当前版本？这是一个明显的开始问题。

但是你也想知道它是否支持旧版本，是否有努力支持未来的版本。重要的是，您添加的任何依赖项都支持您的应用将支持的 Python 和 Django 的相同版本。

一个很好的经验法则是寻找对 Django 长期支持(LTS)版本的支持。

### 测试和记录

当在依赖关系中寻找测试和文档时，我们寻找几样东西:

1.  验证代码是否有效，是否可以测试 bug

2.  解释如何安装和使用软件包，以及它存在的原因

3.  表示有人关心

当然，您应该在依赖项中找到测试，以及广泛覆盖软件包功能的测试。您还应该使用持续集成(CI)系统来寻找自动化测试运行，这样您就可以看到当有人将代码推送到存储库时，测试总是在运行。很难相信有人只是在自己运行测试，如果没有与存储库相关的 CI 系统，那么您将不得不相信贡献者正在运行测试，并且他们通过了测试。

基本文档对于确保您知道如何设置依赖关系以及可能的边缘情况非常重要。例如，它做了什么意想不到的事情或者它与什么相关的包不兼容？对于较大的依赖关系，大量的文档是必须的，但是对于较小的依赖关系，文档不仅是一个帮助，也是一个信号，表明这个包有一个特定的使命(用例),并且提供了足够的上下文，您可以判断作者和/或维护者是否已经考虑和支持了超出他们自己的初始问题的各种用例和开发人员。

第三点直接导致维护节奏。

### 维护节奏

这种依赖看起来会得到积极的支持吗？是否有大量未解决的问题，特别是 bug，没有被解决？是否存在未完成的旧的拉请求，尤其是针对 bug 的拉请求？许多人忽略的一个更重要的问题是，即使报告了问题并合并了拉请求，这些会导致新的发布吗？如果在过去的一年中合并了拉式请求，但是在此期间没有发布新的版本，那么它可能没有得到充分的维护。

### 特定与一般

作为程序员，我们倾向于构建一个解决方案，然后看看如何将这个解决方案抽象出来以解决更多的问题。可以说，这是一件非常好的事情。然而，我们很容易忘乎所以，试图覆盖太多的领域，陷入一个漂亮的抽象的兔子洞，而不是“仅仅”解决你面前的具体问题。

例如，您可能有一个用 Stripe 构建的 SaaS 应用订阅管理库。一个更一般化的方法将考虑不同的订阅和支付后端。然而，除非你自己积极地利用这些不同的场景，否则试图处理它们很可能导致半途而废的解决方案。当你开始使用应用时，创建一个能够处理用户定制场景的更通用的系统将会使你花费更多的时间在抽象上，这些时间可以更好地用于完善你的应用。

编写你的应用来涵盖你能想到的每一个用例几乎肯定是一个错误，不管更一般的用例有多有用。你很可能花时间预测非问题，却没有预测到实际需求。比起构建一个解决不了任何明确问题的过于抽象的解决方案，添加更多的用例，或者制定更通用的、可行的解决方案要好得多。

## 摘要

在本章中，您了解了创建独立应用的好处，包括分享常见问题的解决方案的机会、通过开源审查帮助提高代码质量，以及通过标准化常见问题来改进开发过程。您还了解了 Django 相关的 Python 项目和 Django 应用之间的区别，以及如何权衡附加依赖项的包含。在下一章，我们将研究一个独立应用的结构。