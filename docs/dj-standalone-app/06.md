# 6.使用静态文件

在您自己的 Django 项目中，您可能有静态文件，包括样式表、JavaScript、字体和图像在内的静态资产，所有这些都打算直接提供给最终用户的浏览器。这些静态文件或静态资产允许您控制呈现的 HTML 的布局和样式，并引入客户端(浏览器)交互性。

虽然不太常见，但一些独立的应用程序可能会包含自己的*静态文件*，这意味着可以通过最终用户项目的名称直接引用，也可以通过您自己的应用程序模板引用。各种类型的独立应用程序可能使用静态文件，通常包括提供自定义管理功能的应用程序和捆绑前端框架组件的应用程序。在本章中，我们将逐步介绍在独立应用程序中包含静态资产的意义以及如何包含它们。

## 独立应用程序中的静态文件

历史上，在可重用的应用程序中包含静态文件有两个主要原因:

1.  添加应用程序提供的基于界面的功能，例如，一个更大整体的核心组件。

2.  将静态文件包含在项目生成过程中，例如，包含 JavaScript 框架，以便在运行 collectstatic 时，所需的框架文件自动可用于项目。

后一个原因，包括项目中的 JS 框架这样的静态文件，在很大程度上已经过时了。随着前端应用程序代码和构建管理系统(如 Gulp、Webpack 和 package)的流行，开发人员和团队从这些构建系统中包含和构建这些文件，与 Django 静态管道并行，这种情况要常见得多。

例如，如果应用程序的目的是将 Vue.js 框架包含在项目模板中，那么避免创建 Django 应用程序并配置项目 JavaScript 构建系统(如 Webpack)来直接包含框架将是一个更好的主意。除此之外，这使得对 JavaScript 依赖版本的细粒度和可移植控制成为可能。

这并不是说没有创建可重用应用程序来提供这种功能的用例。对于不保证 JavaScript 构建过程或非常狭窄的用例的较小的内部项目，这仍然是有益的。

相反，在独立的 Django 应用程序中包含静态文件的主要用例是包含基于接口的功能或样式。包含静态文件的机制很简单:

1.  在应用程序目录中添加一个静态/目录。

2.  将静态文件添加到新的静态/目录中。

Note

我们还有一个步骤来确保这些文件包含在最终的*包*中进行分发，但是这足以填充项目。如果最终用户启用了基于应用程序目录的静态文件收集(默认情况下包含)，则在安装了应用程序的项目中和 INSTALLED_APPS 中运行 collectstatic 会将这些文件复制到项目的 STATIC_ROOT 目录中。

```
STATICFILES_FINDERS = [
        ...
        'django.contrib.staticfiles.finders.AppDirectoriesFinder',
]

```

值得注意的是，当您运行 collectstatic 命令来收集项目的所有静态文件时，所有文件都将被聚合到项目的 STATIC_ROOT 目录中，包括它们相对于应用程序静态目录的路径*和*。这意味着，如果您包含 static/style.css，它将作为/static/style.css 包含在最终项目中。这不仅模糊了文件的来源，还会导致命名冲突。

与模板一样，解决方案是包含一个命名子目录来命名文件:

```
myapp/
static/
                myapp/
                        style.css
        templates/
                myapp/
                list.html

```

现在，您的文件将作为/static/myapp/style.css 提供。如果最终用户聚集并缩小这些文件，您的资产的最终名称可能并不重要，但您总是希望避免命名冲突。

## 在 Django admin

如果您的 Django 应用程序包含任何类型的 Django admin 可视化定制，从全面的样式替换到较小的 JavaScript 小部件，您可以像前面描述的那样包含必要的文件。这些文件可以包含在同类的基于目录的名称空间中，或者使用 admin/子目录。这是分割较大文件集合的好方法，尽管为了避免名称冲突，您应该确保文件具有特定于应用程序的名称和/或使用额外的基于目录的命名空间。

此布局将包括 myapp.css 作为/static/admin/myapp.css:

```
myapp/
        static/
                admin/
                        myapp.css
                myapp/
                        style.css

```

然而，没有必要为这些文件使用 admin/namespace，尤其是如果您的应用程序只包含特定于管理员的静态文件。另一方面，如果你的应用程序的目标是*覆盖*或者取代现有的管理文件，那么你应该命名它们，使得文件路径与你想要覆盖的文件完全相同。

```
myapp/
        static/
                admin/
                        css/
                                login.css

```

现在假设 myapp 包含在项目的 INSTALLED_APPS 中的 django.contrib.admin 之后，那么它的 login.css 文件将被用来代替 django 的文件。

最后，如果您在 Django admin 中包含了基于 jQuery 的 JavaScript，请确保您的插件或函数与您想要支持的 Django 版本兼容。如果您这样做，并使用 Django 管理员使用的特殊命名空间——Django 的管理员为其包含的 jQuery 使用`django.jQuery`命名空间以避免与其他引入的版本冲突——您就不需要自己包含 jQuery。另一方面，如果你的定制功能由于某种原因依赖于一个非常特定的 jQuery 版本，你会希望在你的应用程序中包含那个版本。在这种情况下，您可以效仿 Django，使用“普通的”jQuery 名称空间或您自己的名称空间，以避免与任何其他引入的 JavaScript 发生任何后续冲突。

## 摘要

在本章中，您已经学习了如何在您的独立应用程序中包含静态资产，在您的独立应用程序中包含什么样的静态资产是有意义的，以及如何为特定于 Django admin 的功能包含 JavaScript 资产。在下一章，我们将进一步探讨命名空间的问题，激发挑战，并建立一套创建合理和一致的命名系统的策略。