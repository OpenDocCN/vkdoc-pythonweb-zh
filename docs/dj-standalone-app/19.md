# 19.记录您的独立应用程序

一旦你向全世界发布了你的独立应用程序，其他人就会想要使用它。他们将如何使用它？他们将如何安装它？它能解决他们遇到的同类问题吗？在这一章中，我们将看看如何开始解决记录你的独立应用程序的挑战。

## 从问题开始

不管你用什么格式和工具来记录你的独立应用程序，或者你决定如何在你的代码库中分发文档，你所有的文档都应该以回答别人——甚至是未来的你——在处理你的独立应用程序时会遇到的问题为动机。

你应该问的几个问题是*谁将会阅读这篇文章*和*他们正在试图做什么*。最常见的“谁”是开发者用户，他们要么评估是否使用你的独立应用程序，要么寻求帮助将其集成到他们的项目中。但也可能是其他人，另一个试图评估你的独立应用程序是否应该被视为项目选项之一的项目利益相关者。

有人试图做的“什么”更重要，也更容易分解。让我们将这些问题分类如下:

1.  这个独立的应用程序适合我的项目吗？

2.  我如何开始使用它？

3.  它完全有能力做什么？

4.  我如何报告错误或参与进来？

第一个问题是关于*考核*。我所说的评估并不是指对你的应用程序进行排名或打分，而是判断某人是否应该使用它。这是人们在查看你的独立应用程序时会遇到的最广泛、最主观的问题，而且没有单一的、万无一失的方法来解决这个问题。

然而，有几个关键问题你可以也应该解决，这将有助于人们评估你的应用程序，包括(I)回答它解决什么问题，(ii)它如何解决那个问题，和/或(iii)它解决这个问题的方式与其他解决方案有何不同。

一个简单的例子来自独立应用程序 [django-rq](https://github.com/rq/django-rq) :

*   Django 与 RQ 的集成，RQ 是一个基于 Redis 的 Python 队列库。Django-RQ 是一个简单的应用程序，允许您在 Django 的 settings.py 中配置队列，并在您的项目中轻松使用它们。

我们现在确切地知道这是做什么的。我们还不知道如何安装或使用它，但从这两句话中，你可能会对这个应用程序是否会对你有所帮助有一个相当好的想法。

一旦有人决定使用你的应用程序，他们接下来会想知道如何开始使用它。这包括(I)安装，(ii)配置，以及(iii)任何后续的集成或使用步骤。

安装通常很简单，包括 pip 安装和将应用程序添加到 INSTALLED_APPS，但是您应该确保明确这里使用的名称，并记录与预期的任何差异。至于配置，至少您需要包含对项目设置(除 INSTALLED_APPS 之外)的任何更改或添加，例如中间件添加，以及对项目 urls.py 配置的添加。

集成和使用包括使用您的独立应用程序所需的用户自己代码的更改，以及用户应该知道的任何命令或输出。如果你的独立应用包含了视图的 mixin 类，用户应该立即意识到什么属性或方法？如果它包括管理命令，它们的名称是什么，需要哪些参数？你可以包括更多的内容，但是对于即时的回答，像这样的问题将指导你应该包括什么。

最后是用户如何提供反馈或对项目做出贡献的问题。人们很容易将这些问题视为理所当然，并认为答案是不言而喻的——当然只是在回购上制造一个新问题！–但情况并非总是如此，你应该向你的用户说明这一点。一个简单的关于向哪里提交问题或是否有电子邮件提问的声明就足够了，但你可以也应该包括更多的指导，不仅包括在哪里记录问题，还包括如何记录问题。这将节省你的用户和你的时间。

## 文件的形式

文档应该从自述文件开始。这是一个带有或不带有基本标记格式的单个顶级文本文件(例如，README.rst 或 README.md)。它描述了您的应用程序的功能以及如何安装和配置您的项目以使用它，并且包括一些基本的使用文档或指向可以找到它的位置。当人们在公共存储库中看到您的应用程序时，通常会首先看到这个文件，并且很容易将这里的内容包含在 setuptools 用来包含在 PyPI 中的 long_description 中。这也是一个长期运行的约定，所以无论您将文档的其余部分放在哪里，或者您如何组织它们，有人都可以在源根目录下找到这个文件。

除此之外，它有助于在单独的文件或部分中开始您的文档，以解决使用您的应用程序时的需求层次(图 [19-1](#Fig1) )。

![../images/486718_1_En_19_Chapter/486718_1_En_19_Fig1_HTML.jpg](../images/486718_1_En_19_Chapter/486718_1_En_19_Fig1_HTML.jpg)

图 19-1

马斯洛的需求层次，维基百科用户 FireflySixtySeven (CC BY-SA 4.0)举例说明

这种需求层次结构模仿了马斯洛流行的需求层次结构，旨在说明人类需求的层次结构，即在满足上述需求之前，必须满足最低层次的需求。不管心理学理论是否正确，它都是接近文档的有用类比。

在基础级别，安装和配置是第**步。在不知道如何实际获得你的应用程序以及需要转动什么“转盘”的情况下，所有后续的文档都没有什么实用价值。通常自述文件本身就足以满足这一目的，但是如果可用的设置多于几个，那么安装和配置，或者仅仅是配置，可能需要在文档中有它们自己的章节。**

接下来是上一节描述的基本用法和集成。思考这个问题的一个简便方法是快速开始使用你的应用程序，而一个 **quickstart** 是展示如何实际使用你的应用程序的一个很好的方式，而不需要钻研完整的文档。这通常是开始使用应用程序的最低要求，从最常用的命令到将你的应用程序集成到另一个应用程序的简单实用的例子。

对于需要非平凡集成的应用程序，比如构建模块或者甚至额外的框架，一个关于这样做的**教程**是有价值的下一步。教程通过示例指导用户使用软件的步骤，每个步骤都有助于实现明确定义的最终目标。这对于许多独立的应用程序来说是不必要的，但是对于具有重要功能的应用程序来说，这对于显示如何在快速启动不够的地方使用应用程序是有用的。

例如， [django-graphene](https://docs.graphene-python.org/projects/django/en/latest/) 应用程序，一个用于向 django 项目添加 GraphQL 功能的独立应用程序，在其文档中使用了两个这样的教程。基础教程指导用户完成典型的快速入门步骤，然后在示例应用程序中创建示例模型和视图，甚至加载提供的测试数据以匹配指定的模型。从这里，用户可以通过构建一个小应用程序来实际了解应用程序的工作原理，并将文档中描述的结果与他们在自己的计算机上看到的结果进行比较。

教程提供了一种“横向”的方法来记录一个独立的应用程序，从一个问题开始，该问题的示例解决方案包括功能的许多不同方面， **API 参考**提供了一个“纵向”的文档来源，其中的细节是通过实现来组织的。Django 文档很大程度上是这样组织的。Django 文档并没有包含每种问题的教程，而是包含了一个基本的教程，然后是按照功能逻辑组织的详细文档。没有关于如何创建一个在电子邮件报告中发送汇总图书排名信息的应用程序的教程，但有关于如何使用电子邮件、如何使用 Django 的模型类以及各种数据库聚合和表达式的详细文档。

最后，在我们层次的顶端，是食谱。顾名思义，cookbook documentation 是一个食谱的集合，是真实世界中的小例子，既展示了如何使用你的独立应用程序的功能，又提供了如何应用它的灵感。这些可以从真实的用例中提取，也可以是虚构的，尽管不管是否虚构，它们都应该是有用的。

### 代码注释和文档字符串

许多 Python 程序员小心翼翼地记录他们的代码，包括对“有趣的”代码块的注释；解释模块、类和函数的详细文档字符串；甚至键入提示。编写清晰、文档完善的*代码*对于开发来说是一个极好的帮助，尤其是对于新的贡献者，对于那些只想更好地理解你的应用内部的开发者用户来说是一笔财富。也就是说，代码文档和*用法*文档是有区别的。

原因不仅包括如何阅读文档(参见“文档工具”一节)，还包括组织和详细程度。简而言之，当这些问题与应用程序正在解决的问题有关时，源代码通常不会被组织来回答*为什么*和*如何*的问题；它是为了解决问题而组织的。入口点是为执行和导入而设计的，而不是为阅读和浏览而设计的。将文档与源代码分离也是有价值的，因为这种分离使得对文档的贡献更加容易。

小心不要把代码文档误认为用户或项目文档。

## 文档工具

一旦你有了独立应用的文档，下一步就是让潜在用户无需查看源代码就可以阅读。无论您使用的是 reStructuredText 还是 Markdown，都有一些工具可以让您轻松地将文档转换成 web 可部署的 HTML。

最常用的工具是 Sphinx，它主要是为处理 reStructuredText 文档而设计的，尽管它也支持 Markdown。如果您曾经阅读过 Python 或 Django 文档，那么您已经通读了 Sphinx 生成的文档。这是一个强大的工具，但是入门很简单。要安装它并创建初始配置，请在控制台中从 docs 源目录运行以下命令:

```py
pip install Sphinx
sphinx-quickstart

```

sphinx-quickstart 命令将引导您完成几个提示，以帮助您确定在何处包含构建的 HTML、基本项目信息和编写文档所用的自然语言。生成的 Makefile——或者 make.bat，如果您使用的是 Windows——可以用来读取重构的文本源文件，并创建可浏览和可搜索的 HTML 文件。您也可以构建其他格式，包括 PDF，尽管这可能需要额外的软件，如 LaTeX。

使用 Sphinx 和 reStructuredText 构造文档的细节超出了我们在这里讨论的范围；然而，reStructuredText 允许您创建丰富的索引，还可以从独立应用程序的源代码构建文档。

对于那些强烈倾向于使用 Markdown 的人来说，Sphinx 的替代方案是 MkDocs。Markdown 和 MkDocs 在功能上的不足，在简单性上得到了弥补。MkDocs 项目是使用 Yaml 文件而不是 Python 来配置的，与 reStructuredText 相比，Markdown 的语法以及功能更加精简。如果你和其他已经熟悉降价的人一起工作，这可能是一种优势。就像 Sphinx 一样，MkDocs 将获取您的文档源并创建可浏览、可搜索的 HTML 文档。

一旦有了可以将文档源转换成 HTML 的工具，就差不多可以部署它了，这样开发人员用户就可以在线浏览文档了。最简单的方法是通过 web 提供构建的 HTML，例如，将其复制到 Web 服务器，添加到存储库分支以使用 GitHub 页面等。虽然这种方法可行，但它确实引入了大量的手动工作。

相反，您可以使用[阅读文档](https://readthedocs.org/)来自动构建和托管您的项目文档。read Docs 将与 Sphinx 或 MkDocs 一起工作，如果您使用 GitHub、Bitbucket 或 GitLab，它将允许您使用项目集成来连接您的存储库，以从存储库更新进行构建(您也可以将它用于其他源代码平台；但是，这将需要更多的手动设置)。

## 摘要

在本章中，您已经学习了如何开始为您的独立应用程序编写面向用户的文档，包括在指导它时要问什么样的问题、适合用户的文档形式以及实际部署文档的工具。

在下一章中，我们将深入研究测试中的其他主题，包括测试迁移以及如何测试不同版本的 Python 和 Django。