# 9.范围界定和绘制边界

在第一章中，我们简要讨论了界定 Django 独立应用的范围意味着什么，包括你创建独立应用的目标，对第三方依赖的考虑，以及应用预期执行的*工作*。

在这一章中，我们将更深入地回顾这些相同的考虑，特别是关于在现有代码库的上下文中寻找一个可能的 Django 独立应用。

## 问题的范围和性质

定义软件项目的范围是项目的首要挑战之一，也是最重要的挑战之一。范围定义了它将做什么，边界在哪里，并且不仅影响项目的代码行大小，还影响它的复杂程度，它可以支持多少功能，以及测试和维护软件的挑战性。

在您自己的项目中编写的应用程序可能有一个明确的范围，但是当它是项目源代码的一个集成部分时，边界很容易变得模糊。这可能是因为功能蠕变或某些即时便利——在应用程序中包含一些新的小功能更简单或更方便，即使该功能的目的与应用程序的核心工作正交，或过于特定于您的特定项目。

应用程序的范围也将影响需要什么依赖关系。随着“依赖表面积”的增加，应用程序在维护和版本支持方面的脆弱性也在增加。如果你的独立应用依赖于 Django，那么它只需绑定到 Django 版本。然而，如果它需要 Django 和一个或多个附加的独立应用程序，那么它很可能会受到所有依赖项在支持 Django 和 Python 版本时重叠程度的限制。从你自己的项目中减少你的独立应用程序的范围，预期的效果是使它更容易维护。

## 独立应用程序的工作

*   你说你在这里做什么？

如果你在寻找一种启发式的方法来界定应用的范围，你可以做得比简单地写一份简短的工作描述更糟。作为一名员工，你可能有一个不合适的职称和众多不同的职责，但如果你把它剥离，那么很可能你可以在你所做的事情之外为你的工作定义一个目标。作为一名软件开发人员，你的工作是将业务需求转化为工作软件。作为首席执行官，你的工作是领导公司实现增长和盈利(至少在大多数地方是这样)。可能会有更多的工作职责，这些职责可能很重要，但是几乎每份工作都有一个单一的目的。同样，你的独立应用应该有一个指导性的目的，可以简单明了地描述。

设身处地为营销人员着想(不，真的)。你会如何描述你的应用？它解决什么问题？它是如何解决这个问题的？对于许多其他应用程序，它是如何解决这个问题的？

这些问题的答案*将*有助于开源软件包的营销，但这不是我们问这些问题的原因。

以下是几个流行的独立 Django 应用程序，用我自己的话来说，是它们的简短工作描述:

*   Wagtail 的工作是以一种用户友好的方式使用户可编辑的内容更容易建模和服务。

*   Django REST 框架的工作是为创建 RESTful APIs 和将现有的 Django 应用程序连接到 API 提供类似 Django 的体验。

*   django-taggit 的工作是在分类学的意义上，使向 django 项目中的任何类型的对象添加标签变得容易

*   **Easy Thumbnails** 的工作是为单个上传的图像创建调整大小的图像。

这些应用程序的大小和它们提供的功能范围各不相同，但在每种情况下，所有这些功能都可以追溯到一个非常明确的目的。

## 创建和提取的维度

你可以从几个方面来看待一个独立的应用程序；在这里，我想把重点放在我称之为垂直和水平细分的轴上，或者换句话说，业务功能与技术基础。在下图中，我们看到一个特性(黄色条)是通过任何应用程序或项目的水平组件的垂直切片(图 [9-1](#Fig1) )。

![../images/486718_1_En_9_Chapter/486718_1_En_9_Fig1_HTML.jpg](../images/486718_1_En_9_Chapter/486718_1_En_9_Fig1_HTML.jpg)

图 9-1

垂直和水平分割

不要被说服这允许某种科学分类；相反，这是一种评估模块如何分解和组织的便捷方式，在独立的 Django 应用程序环境中，如何定义它们的工作。

水平分割的模块——应用程序或其他——提供了某种通用的“基础设施”,可以在支持功能开发的项目中使用。这是一段只有开发人员才能体验到的代码(总的来说)。

例子包括

*   django-model-utils

*   django-扩展

*   姜戈-克里西弗斯

这些主要解决开发团队面临的问题，比如使复杂表单的呈现变得更容易，提供公共基类以避免重复的样板代码。

项目中水平组织的代码看起来像这样，强调通过*代码首先做什么*以及它其次解决什么业务领域来组织:

```
app/
        forms/
        models/
                ...
                image_models.py
                user_models.py
                subscription_models.py
        views/

```

这看起来很熟悉，因为这是在 Django 应用程序中组织代码的惯例，但也是在其他框架中组织项目代码的惯例。

另一方面，垂直分割的模块首先是围绕业务需求组织的，也就是说，通常是用户将会经历的事情。

例子包括

*   决哥，请回答

*   干草堆

*   姜戈-沙阿

显然，这不是一个“非此即彼”的区别。但 Django 以应用为中心的架构鼓励垂直或基于功能的组织。Django 应用程序包括从模型到 URL 路由到表单和视图的所有内容。这必然是独立应用程序发布的方式，但这也是 Django 项目中应用程序的默认模式。

如果你的目标功能看起来像是与功能无关的东西，它可能需要包含在一个独立于功能的应用程序中。

## 确定应用程序的范围

一个独立的 Django 应用程序应该足够大以完成它的工作，而不是更大。但是那有多大呢？错误地确定独立应用程序的范围会有什么后果？你如何解决一个看起来太小或太大的应用程序？

首先，一个应用程序不应该比它的工作大。但也要足够大。如果它太大，要么它做得太多，要么它本身就是另一个框架。太小，它可能不保证创建一个独立的应用程序，甚至是一个可安装包。

### 当应用程序太大时

一个 app 太大意味着什么？有一些相当大的独立应用不一定太大。答案一清二楚:*看情况*。让一个应用变得太大的第一件事是包含无关紧要的功能，这些功能要么对应用不重要，要么在他们的*自己的应用*中足够有用。一个容易处理的例子是一个包含自己的工具基类的应用程序，就像你在 django-model-utils 中找到的那种。这些额外的功能可能会在维护应用程序和添加功能时分散注意力。它们也增加了需要测试的代码量。如果有必要，不要抛弃它们，但要确保它们是必要的。

对于太大的应用程序，有几个突出的解决方案:

*   把它分成单独的包裹。

*   组织成子应用程序。

如果至少有一个潜在的包本身就足够有用的话，那么分解成单独的包是一个好主意。在这种情况下，独立包的好处是可以为更多的用例提供更广泛的服务。然而，无论是否是独立的应用程序，每个额外的包都会增加维护成本，并可能使确保两个组件继续良好合作变得更具挑战性。

如果它们是相互依赖的，那么创建单独的包没有好处，在一个包中使用子应用或迷你应用是更好的选择。

将独立应用组织成子应用需要将每个应用单独添加到目标项目的 INSTALLED_APPS 中，如下所示:

```
INSTALLED_APPS = [
        ...
        "cms",
        "cms.pages",
        "cms.photos",
        ...
]

```

这种策略包括一个主要的顶级应用程序，以及附属和组成功能应用程序，作为它们自己的可安装应用程序。虽然比只添加一个“核心”应用程序要笨拙，但这可能允许您更好地逻辑构建组件，并允许开发人员用户排除他们不需要的功能。这不会减少你的应用程序的源代码，但它确实减少了任何使用应用程序的人必须考虑的范围。

### 当应用程序太小时

制作一个太小的应用程序的问题与制作一个太大的应用程序的问题是不同的，可以说没有那么重要。主要的问题是，它有导致大量微小依赖的风险，这些依赖都需要被包含和维护。当独立包的数量超出了你容易记住的数量时，使用独立包的好处就减少了。我们希望尽量减少我们的应用程序对其他人的项目的依赖性。

如果你打算创建多个小应用程序，首先考虑它们是否真的有意义，或者它们是否在功能或业务领域有足够的通用性来捆绑在一起。如果您发现自己在不止一个项目中同时使用这些特性，很可能就是这种情况。

不过，创建一个小小的独立应用不应该被视为禁止。在光谱的两端有明显的张力。

## 摘要

在本章中，您学习了如何确定应用程序的范围，包括定义应用程序要完成的工作、评估应用程序可能的功能和组件维度，以及确定如何评估和调整范围的大小。在下一章，我们将学习如何从现有的 Django 项目开始重构和提取你的应用程序。